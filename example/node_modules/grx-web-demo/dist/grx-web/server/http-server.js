"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.server = void 0;
// server/http-server.ts
const http_1 = require("http");
const middleware_chain_1 = require("../middleware/middleware-chain");
exports.server = (0, http_1.createServer)(async (req, res) => {
    const ctx = {
        req,
        res,
        json: (input) => {
            res.writeHead(200, { "Content-Type": "application/json" });
            res.end(JSON.stringify(input));
        },
        middlewaredData: new Map(),
        getMiddlewareData(key) {
            return this.middlewaredData.get(key);
        },
        setMiddlewareData(key, value) {
            this.middlewaredData.set(key, value);
        }
    };
    try {
        await (0, middleware_chain_1.next)(ctx, 0);
    }
    catch (error) {
        res.statusCode = 500;
        res.end('Internal Server Error');
        console.log(error);
    }
});
